<?xml version="1.0" encoding="UTF-8"?>
<mule 
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:spring="http://www.springframework.org/schema/beans"
	xmlns:jms="http://www.mulesoft.org/schema/mule/jms"
	xsi:schemaLocation="
		http://www.springframework.org/schema/beans     http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
		http://www.mulesoft.org/schema/mule/core  http://www.mulesoft.org/schema/mule/core/3.3/mule.xsd
		http://www.mulesoft.org/schema/mule/jms   http://www.mulesoft.org/schema/mule/jms/3.3/mule-jms.xsd
	">
	
	<spring:beans>
		<spring:bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource">
			<spring:property name="url" value="jdbc:mysql://${LOGMANAGER_DB_HOST}:${LOGMANAGER_DB_PORT}/${LOGMANAGER_DB_NAME}" />
			<spring:property name="username" value="${LOGMANAGER_DB_USER}"/>
			<spring:property name="password" value="${LOGMANAGER_DB_PASSWORD}"/>
			<spring:property name="initialSize" value="${LOGMANAGER_POOL_INITIALIZE}" />
			<spring:property name="maxActive" value="${LOGMANAGER_POOL_MAX_ACTIVE}" />
			<spring:property name="maxIdle" value="${LOGMANAGER_POOL_MAX_IDLE}" />
			<spring:property name="minIdle" value="${LOGMANAGER_POOL_MIN_IDLE}" />
			<spring:property name="maxWait" value="${LOGMANAGER_POOL_MAX_WAIT}" />
		</spring:bean>
	</spring:beans>
	
	<custom-transformer name="jmsToLogEvent" class="se.skl.tp.vp.logmanager.JmsToLogEventTransformer" />
	
	<model name="LogManager-model">
	
		<service name="LogManager-service">
			<inbound>
				<jms:inbound-endpoint address="jms://${SOITOOLKIT_LOG_INFO_QUEUE}" transformer-refs="jmsToLogEvent"/>
			</inbound>
			<component>
				<singleton-object class="se.skl.tp.vp.logmanager.LogManager">
					<property key="dataSource" value-ref="dataSource" />
					<property key="whiteList" value="${IP_WHITE_LIST}" />
				</singleton-object>
			</component>
		</service>
	</model>
	
</mule>