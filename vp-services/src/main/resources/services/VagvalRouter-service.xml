<?xml version="1.0" encoding="utf-8"?>
<mule xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:spring="http://www.springframework.org/schema/beans"
    xmlns:cxf="http://www.mulesoft.org/schema/mule/cxf"
    xmlns="http://www.mulesoft.org/schema/mule/core"
    xsi:schemaLocation="
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
		http://www.mulesoft.org/schema/mule/core 	http://www.mulesoft.org/schema/mule/core/3.3/mule.xsd
		http://www.mulesoft.org/schema/mule/cxf 	http://www.mulesoft.org/schema/mule/cxf/3.3/mule-cxf.xsd" >

    <flow name="vagval-dynamic-routing-flow" >

        <transformer ref="createCorrId" />
        <transformer ref="fixTransformer" />
        <transformer ref="rivExtractor" />
  		<transformer ref="logReqIn" />
        <transformer ref="rivTransformer" />
        
        <cxf:proxy-client payload="envelope" />

        <custom-processor class="se.skl.tp.vp.vagvalrouter.VagvalRouter" >

            <spring:property
                name="vagvalAgent"
                ref="vagvalAgent" />

            <spring:property
                name="senderIdPropertyName"
                value="${VAGVALROUTER_SENDERID}" />

            <spring:property
                name="responseTimeout"
                value="${SERVICE_TIMEOUT_MS}" />

            <spring:property
                name="whiteList"
                value="${IP_WHITE_LIST}" />
        </custom-processor>
        
        <response>
            <transformer ref="exceptionTransformer" />
            <transformer ref="logRespOut" />
        </response>
        
         <custom-exception-strategy class="org.soitoolkit.commons.mule.error.ServiceExceptionStrategy" />
    </flow>

</mule>