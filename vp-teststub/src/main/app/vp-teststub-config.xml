<?xml version="1.0" encoding="UTF-8"?>
<!--

    Copyright (c) 2013 Sveriges Kommuner och Landsting (SKL).
    								<http://www.skl.se/>

    This file is part of SKLTP.

    This library is free software; you can redistribute it and/or
    modify it under the terms of the GNU Lesser General Public
    License as published by the Free Software Foundation; either
    version 2.1 of the License, or (at your option) any later version.

    This library is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
    Lesser General Public License for more details.

    You should have received a copy of the GNU Lesser General Public
    License along with this library; if not, write to the Free Software
    Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA

-->
<mule 
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:spring="http://www.springframework.org/schema/beans"
	xmlns:https="http://www.mulesoft.org/schema/mule/https"
	xsi:schemaLocation="
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
		http://www.mulesoft.org/schema/mule/core    http://www.mulesoft.org/schema/mule/core/current/mule.xsd
		http://www.mulesoft.org/schema/mule/https		http://www.mulesoft.org/schema/mule/https/current/mule-https.xsd
	">


    <spring:beans>
 	  <spring:import resource="classpath:soitoolkit-mule-jms-connector-activemq-external.xml"/>

      <!-- Load all teststub services
      <spring:import resource="classpath:vp-teststubs-and-services-config.xml"/>
      <spring:import resource="classpath:teststub-services/vp-virtuell-tjanst-teststub-service.xml"/>
      -->
      <spring:import resource="classpath:teststub-services/vp-producer-teststub-service.xml"/>
      <spring:import resource="classpath:teststub-services/tk-teststub-service.xml"/>
      <spring:import resource="classpath:teststub-services/VagvalAgentTest-teststub-service.xml"/>

      <!-- Load all resources needed by the core artifact 
      <spring:import resource="classpath:vp-config.xml"/>
      -->
      
      <!-- Load property files and other common declarations 
      <spring:import resource="classpath:vp-common.xml"/>
      -->
    </spring:beans>

	<!-- Copied from vp-common.xml since muleStartupNotification is defined in vp-common.xml but shall not be used in a teststub-server -->
	<spring:bean id="propertyPlaceholder" class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
		<spring:property name="ignoreResourceNotFound" value="true" />
		<spring:property name="locations">
			<spring:list>
				<!-- Only available in development env, e.g. Eclipse -->
				<spring:value>classpath:vp-security.properties</spring:value>
				<spring:value>classpath:vp-config.properties</spring:value>
				
				<!-- Only available when deployed to a servlet container -->
				<spring:value>file:${app.home}/vp/config/vp-security.properties</spring:value>
				<spring:value>file:${app.home}/vp/config/vp-config.properties</spring:value>
			</spring:list>
		</spring:property>
	</spring:bean>
	
    <!-- Https connector used when acting as a producer, ie receiving calls,  sends no session info-->
  	<https:connector name="VPProducerConnector" keepSendSocketOpen="false" keepAlive="false" clientSoTimeout="${SERVICE_TIMEOUT_MS}" socketSoLinger="${SOCKET_SO_LINGER_MS}">
		<service-overrides sessionHandler="org.mule.session.NullSessionHandler" />
		<https:tls-key-store class="${TP_TLS_STORE_PRODUCER_TYPE}"     path="${TP_TLS_STORE_LOCATION}/${TP_TLS_STORE_PRODUCER_FILE}" storePassword="${TP_TLS_STORE_PRODUCER_PASSWORD}" keyPassword="${TP_TLS_STORE_PRODUCER_KEY_PASSWORD}" /> 
		<https:tls-server    class="${TP_TLS_STORE_TRUSTSTORE_TYPE}" path="${TP_TLS_STORE_LOCATION}/${TP_TLS_STORE_TRUSTSTORE_FILE}" storePassword="${TP_TLS_STORE_TRUSTSTORE_PASSWORD}" requireClientAuthentication="true"/>
	</https:connector>

    <!-- Https connector used when acting as a consumer, ie making calls, sends no session info -->
  	<https:connector name="VPConsumerConnector" keepSendSocketOpen="false" keepAlive="false" clientSoTimeout="${SERVICE_TIMEOUT_MS}" socketSoLinger="${SOCKET_SO_LINGER_MS}">
		<service-overrides sessionHandler="org.mule.session.NullSessionHandler" />
  	    <https:tls-key-store class="${TP_TLS_STORE_CONSUMER_TYPE}"     path="${TP_TLS_STORE_LOCATION}/${TP_TLS_STORE_CONSUMER_FILE}" storePassword="${TP_TLS_STORE_CONSUMER_PASSWORD}" keyPassword="${TP_TLS_STORE_CONSUMER_KEY_PASSWORD}" /> 
		<https:tls-server    class="${TP_TLS_STORE_TRUSTSTORE_TYPE}" path="${TP_TLS_STORE_LOCATION}/${TP_TLS_STORE_TRUSTSTORE_FILE}" storePassword="${TP_TLS_STORE_TRUSTSTORE_PASSWORD}" requireClientAuthentication="true"/>
	</https:connector>

</mule>