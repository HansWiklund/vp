# Installera vp-1.3.1

1. Uppgradera databasen

1.1 Navigera till katalogen där vp-distribution är uppackad
	cd vp-distribution-1.3.1/sql
	
1.2 Uppgradera ddl med hjälp av script
	mysql -u tploguser -p < tp_logs_1.3.1.sql
	
2. Uppdatera vp-config.properties

2.1 Navigera till config katalog
	cd ~/vp/vp-home/vp/config
	
2.2 Editera property fil
	nano -w vp-config.properties
	
2.3 Uppdatera följande properties

	SERVICE_TIMEOUT_MS=30000
	
2.4 Lägg till följande properties

	#
	# If behind a reverse proxy, a client auth
	# certificate is expected to be in the
	# x-vp-auth-cert http header.
	# If a certificate is found, the caller ip
	# address must be in a white list of IP-addresses.
	# This property is used to define this list
	# Example: IP_WHITE_LIST=localhost, 127.0.0.1, 192.168.0.15
	# 
	IP_WHITE_LIST=

	#
	# Connection pool configuration for
	# LogManager that reads from JMS queue and
	# writes to log database.
	# For more info about the configuration, see:
	# http://commons.apache.org/dbcp/configuration.html
	#
	LOGMANAGER_POOL_INITIALIZE=0
	LOGMANAGER_POOL_MAX_ACTIVE=8
	LOGMANAGER_POOL_MAX_IDLE=8
	LOGMANAGER_POOL_MIN_IDLE=0
	LOGMANAGER_POOL_MAX_WAIT=-1
	
2.5 Ta bort följande properties

	TP_HOST=localhost
	TP_HTTPS_CLIENT_TIMEOUT=30000
	
3. Stoppa mule

3.1 Navigera till bin katalog
	cd ~/bin
	
3.2 Stoppa mule
	sh stop.sh
	
4. Uppgradera VP

4.1 Navigera till katalog där vp-distribution är upppackad
	cd vp-distribution-1.3.1/lib
	
4.2 Kopiera jar-filer till Mule lib/user katalog
	cp -rf *.jar ~/vp/mule-standalone-2.2.8/lib/user
	
5. Uppdatera log properties

5.1 Editera log4j.properties
	nano -w ~/vp/mule-standalone-2.2.8/conf/log4j.properties
	
5.2 Lägg till följande rader

	log4j.category.org.soitoolkit.commons.mule.messageLogger=DEBUG, devnull
	log4j.additivity.org.soitoolkit.commons.mule.messageLogger=false
	
	log4j.appender.devnull=org.apache.log4j.FileAppender
	log4j.appender.devnull.File=/dev/null
	log4j.appender.devnull.layout=orgpache.log4j.PatternLayout
	log4j.appender.devnull.layout.ConversionPattern=%-5p %d [%t] %c: %m%n
	
6. Starta mule

6.1 Navigera till bin katalog
	cd ~/bin
	
6.2 Starta Mule
	sh start.sh && tail -f ~/vp/mule-standalone-2.2.8/logs/vp.log
	
6.3 Verifiera att mule start upp
	